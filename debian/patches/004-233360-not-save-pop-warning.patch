Description: <short summary of the patch>
 TODO: Put a short summary on the line above and replace this paragraph
 with a longer explanation of this change. Complete the meta-information
 with other relevant fields (see below for details). To make it easier, the
 information below has been extracted from the changelog. Adjust it or drop
 it.
 .
 nfs-screenshot (1.0-9) trusty; urgency=utility
 .
     *[232227]:ä¿®æ”¹å¿«æ·é”®å†²çªçš„é—®é¢˜
     *é—®é¢˜åŸå› :å¿«æ·é”®æ³¨å†Œå†²çª
     *é—®é¢˜è§£å†³æ–¹æ¡ˆï¼šå»æ‰é‡å¤çš„å¿«æ·é”®ï¼Œä¿®æ”¹ctrl+zä¸ºctrl+alt+z
Author: zhanglei <zhanglei_hlj@nfs-china.com>

---
The information above should follow the Patch Tagging Guidelines, please
checkout http://dep.debian.net/deps/dep3/ to learn about the format. Here
are templates for supplementary fields that you might want to add:

Origin: <vendor|upstream|other>, <url of original patch>
Bug: <url in upstream bugtracker>
Bug-Debian: https://bugs.debian.org/<bugnumber>
Bug-Ubuntu: https://launchpad.net/bugs/<bugnumber>
Forwarded: <no|not-needed|url proving that it has been forwarded>
Reviewed-By: <name and email of someone who approved the patch>
Last-Update: 2017-06-07

--- nfs-screenshot-1.0.orig/nfs/nfs-screenshot/js/canvasPainter.js
+++ nfs-screenshot-1.0/nfs/nfs-screenshot/js/canvasPainter.js
@@ -49,12 +49,15 @@ var is_clipboard_true = 1;  //å‰ªåˆ‡æ¿ç
 var is_clipboard_false = 0;  //éå‰ªåˆ‡æ¿
 var is_clipboard_status = 0;	
 var img = null;
-var loading = false
+var loading = false;
 
 // Load native UI library.
 var gui = require('nw.gui');
 var win = gui.Window.get();
 
+
+
+var _Isreset=false;
 // We can not create a clipboard, we have to receive the system clipboard
 var isShowWindow = true;
 var FULLSCREEN = "0";
@@ -386,6 +389,30 @@ $(document).ready(function () {
 
     //å…³é—­æŒ‰é’®ç‚¹å‡»äº‹ä»¶
     $(".close_a").click(function () {
+ 	if(_Isreset)
+        {
+               $.MessageBox({
+                              title: 'è­¦å‘Š',
+                              content: 'å›¾ç‰‡æœªä¿å­˜ï¼Œæ˜¯å¦é€€å‡º',
+                              type: 'confirmation', background: 'write',
+                              buttons: { confirm: {title: 'æ˜¯', style: 'continue'}, cancel: {title: 'å¦', style: 'cancel' } },
+                              usekey: true
+                              },function(response) {
+                                                        if(response)
+                                                         {
+                                                             gui.App.unregisterGlobalHotKey(shortcut);
+                                                             gui.App.unregisterGlobalHotKey(shortcut2);
+                                                             gui.App.unregisterGlobalHotKey(shortcut3);
+                                                             gui.App.unregisterGlobalHotKey(shortcut4);
+							     win.close();
+							  }
+                                                          });
+
+
+            }
+	else
+	{
+
         gui.App.unregisterGlobalHotKey(shortcut);
         gui.App.unregisterGlobalHotKey(shortcut2);
         gui.App.unregisterGlobalHotKey(shortcut3);
@@ -394,6 +421,7 @@ $(document).ready(function () {
 //        gui.App.unregisterGlobalHotKey(shortcut6);
 //        gui.App.unregisterGlobalHotKey(shortcut7);
         win.close();
+	}
     });
 
     //å…¨å±æˆªå›¾ï¼Œå®ç°é€šè¿‡è°ƒç”¨åº•å±‚pythonè„šæœ¬å®ç°
@@ -512,12 +540,12 @@ $(document).ready(function () {
         if (!isSaveImage) {
             if (_sourceCanvas != undefined) {
 		$("#cancelBtn").trigger("click");
-                isSaveImage = true;
-		
+		isSaveImage =true;
 		_sourceContext.drawImage(_textCanvas,0,0);
 		_sourceCanvas.style.zIndex = 1;   //æµ‹è¯•
-                var base64Data = _sourceCanvas.toDataURL().replace(/^data:image\/\w+;base64,/, "");
-                saveImage(base64Data);		
+	        var base64Data = _sourceCanvas.toDataURL().replace(/^data:image\/\w+;base64,/, "");
+		saveImage(base64Data);
+		_Isreset = false;
             }
         }
 
@@ -886,6 +914,7 @@ mouseDown = function (e) {
             _syncSquareObj.color = _color;
             _syncSquareObj.lineWidth = _lineWidth;
 	     _paint = true;
+	    _Isreset = true;
         } else if (_drawMode == "ellipse") {
             _syncCircleObj = new SyncCircle();
             _syncCircleObj.beginPos.x = mouseX;
@@ -894,13 +923,16 @@ mouseDown = function (e) {
             _syncCircleObj.color = _color;
             _syncCircleObj.lineWidth = _lineWidth;
 	     _paint = true;
+	     _Isreset = true;
         }else if(_drawMode == "arrow"){
             _syncArrowObj = new SyncArrow();
             _syncArrowObj.beginPos.x = mouseX;
             _syncArrowObj.beginPos.y = mouseY;
             _syncArrowObj.color = _color;
             _syncArrowObj.brushWidth = _brushWidth;
-	     _paint = true;
+	    _paint = true;
+            _Isreset = true;
+
         }
         else if(_drawMode == "pencil"){
             _lineObj = new Line();
@@ -915,7 +947,9 @@ mouseDown = function (e) {
             _syncLineObj.beginPos.y = mouseY;
             _syncLineObj.color = _color;
             _syncLineObj.lineWidth = _lineObj.lineWidth;
-	     _paint = true;
+	    _paint = true;
+	    _Isreset = true;
+
         }else if (_drawMode == "eraser"){
             _eraserObj = new Eraser();
             _eraserObj.x = mouseX;
@@ -929,7 +963,9 @@ mouseDown = function (e) {
             _syncEraserObj.beginPos.y = mouseY;
             _syncEraserObj.color = "white";
             _syncEraserObj.lineWidth = _eraserWidth;
-	     _paint = true;
+	    _paint = true;
+	    _Isreset = true;
+
         }else if(_drawMode == "text"){
 	     if(isReDrawFlag) {  //å¦‚æœä¸ºçœŸçš„è¯ï¼Œé‚£ä¹ˆå°±æŠŠå†…å®¹ç”»ä¸Šå»
                             var words = $(".text_box").val();
@@ -952,6 +988,8 @@ mouseDown = function (e) {
 				_syncTextObj.beginPos.x = mouseX;
 				_syncTextObj.beginPos.y = mouseY;
 				map.put(map.getCount(),new createCanvasOperation(_drawMode,_syncTextObj));
+				_Isreset = true;
+
                             }
                         }	
 	}
